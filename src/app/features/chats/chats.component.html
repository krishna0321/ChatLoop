<div class="layout" (click)="closeAll()">

  <!-- LEFT SIDEBAR -->
  <aside class="sidebar" [class.mobileHide]="!mobileListOpen" (click)="$event.stopPropagation()">
    <div class="top">
      <div class="logoRow">
        <div class="logo">
          <span class="logoDot"></span>
          Chatloop
        </div>
        <div class="tag">Telegram UI</div>
      </div>

      <div class="searchWrap">
        <span class="sIcon">ğŸ”</span>
        <input
          class="search"
          [(ngModel)]="searchText"
          (input)="applyFilter()"
          placeholder="Search chats..."
        />
      </div>
    </div>

    <div class="list">
      <div
        *ngFor="let r of filteredRooms"
        class="item"
        [class.active]="selectedRoomId === r.id"
        (click)="openRoom(r)"
      >
        <div class="avatar">{{ (getRoomTitle(r)[0] || 'U') }}</div>

        <div class="info">
          <div class="row">
            <div class="name">{{ getRoomTitle(r) }}</div>
            <div class="time">{{ formatTime(r.updatedAt) }}</div>
          </div>

          <div class="row2">
            <div class="preview">{{ getPreviewText(r) }}</div>

            <div class="right">
              <span *ngIf="isPinned(r)" class="icon">ğŸ“Œ</span>
              <span *ngIf="isMuted(r)" class="icon">ğŸ”•</span>

              <div *ngIf="getUnread(r) > 0" class="badge">
                {{ getUnread(r) }}
              </div>
            </div>
          </div>
        </div>

        <button class="more" (click)="openMenu($event, r)">â‹®</button>

        <div class="dropdown" *ngIf="menuRoomId === r.id" (click)="$event.stopPropagation()">
          <button (click)="toggleMute(r)">
            {{ isMuted(r) ? 'ğŸ”” Unmute' : 'ğŸ”• Mute' }}
          </button>

          <button (click)="togglePin(r)">
            {{ isPinned(r) ? 'ğŸ“Œ Unpin' : 'ğŸ“Œ Pin' }}
          </button>
        </div>
      </div>

      <div *ngIf="filteredRooms.length === 0" class="emptyLeft">
        No chats found
      </div>
    </div>
  </aside>

  <!-- RIGHT CONTENT -->
  <main class="content">
    <!-- DM Chat -->
    <ng-container *ngIf="selectedUser">
      <div class="mobileTopBar">
        <button class="backBtn" (click)="backToList()">â¬…</button>
        <span class="mTitle">{{ selectedUser.name || selectedUser.email || 'Chat' }}</span>
      </div>

      <app-chat [user]="selectedUser"></app-chat>
    </ng-container>

    <!-- Room Chat -->
    <ng-container *ngIf="selectedRoomId && !selectedUser">
      <div class="mobileTopBar">
        <button class="backBtn" (click)="backToList()">â¬…</button>
        <span class="mTitle">Room</span>
      </div>

      <app-chat-room [roomId]="selectedRoomId"></app-chat-room>
    </ng-container>

    <!-- Empty -->
    <ng-container *ngIf="!selectedUser && !selectedRoomId">
      <div class="empty">
        <div class="iconBig">ğŸ’¬</div>
        <div class="t1">Select a chat</div>
        <div class="t2">Choose from the left panel</div>
      </div>
    </ng-container>
  </main>

</div>
