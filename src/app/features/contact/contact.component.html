<div class="contacts-panel">

  <!-- Header -->
  <div class="header">
    <div>
      <div class="title">Contacts</div>
      <div class="subtitle">{{ filtered.length }} saved contacts</div>
    </div>

    <div class="header-actions">
      <button class="btn ghost" (click)="openScanner()">ğŸ“· Scan QR</button>
      <button class="btn primary" (click)="openAdd()">â• Add</button>
    </div>
  </div>

  <!-- âœ… Search -->
  <div class="search-wrap">
    <div class="icon">ğŸ”</div>

    <input
      class="search"
      placeholder="Search contacts..."
      [(ngModel)]="search"
      (input)="applyFilter()"
    />
  </div>

  <!-- âœ… Contact List -->
  <div class="list" *ngIf="filtered.length > 0; else emptyTpl">
    <div class="item" *ngFor="let c of filtered">
      <div class="avatar">

  <img
    *ngIf="c.photoURL"
    [src]="c.photoURL"
    class="avatar-img"
  />

  <span *ngIf="!c.photoURL">
    {{ (c.name || 'C')[0] }}
  </span>

</div>


      <div class="info">
        <div class="name">{{ c.name || 'Unknown' }}</div>

        <div class="sub">
          <span>{{ c.phone || 'No phone' }}</span>
          <span class="tag gray" *ngIf="c.uid">UID</span>
        </div>
      </div>

      <div class="actions">
        <button
          class="chat-btn"
          (click)="openChatByUid(c.uid); $event.stopPropagation()"
          *ngIf="c.uid"
          title="Chat"
        >
          ğŸ’¬
        </button>

        <button
          class="icon-btn danger"
          (click)="removeContact(c); $event.stopPropagation()"
          title="Remove"
        >
          ğŸ—‘
        </button>
      </div>
    </div>
  </div>

  <!-- Empty -->
  <ng-template #emptyTpl>
    <div class="empty">
      <div class="empty-emoji">ğŸ“</div>
      <div class="empty-title">No contacts found</div>
      <div class="empty-sub">Add friends or scan QR to save contacts.</div>
    </div>
  </ng-template>
</div>

<!-- âœ… QR Scanner Modal -->
<div class="modal" *ngIf="showScanner" (click)="closeScanner()">
  <div class="box scanner-box" (click)="$event.stopPropagation()">
    <div class="mTitle">ğŸ“· Scan QR</div>
    <div class="mSub">Scan Chatloop QR / URL</div>

    <div class="scanner">
      <div id="qr-reader"></div>
    </div>

    <div class="actions2">
      <button class="btn ghost" (click)="closeScanner()">Close</button>
    </div>
  </div>
</div>

<!-- âœ… SCAN RESULT -->
<div class="modal" *ngIf="showScanResult" (click)="closeScanResult()">
  <div class="box result-box" (click)="$event.stopPropagation()">
    <div class="mTitle">âœ… User Found</div>
    <div class="mSub">Add friend or open chat</div>

    <div class="result-user" *ngIf="scannedUser as u">
      <div class="avatar">{{ (u.name || 'U')[0] }}</div>

      <div class="meta">
        <div class="name">{{ u.name || 'User' }}</div>
        <div class="uid">UID: <span>{{ u.uid }}</span></div>
      </div>
    </div>

    <div class="actions2">
      <button class="btn ghost" (click)="closeScanResult()">Cancel</button>
      <button class="btn ghost" (click)="addFriendFromScan()">â• Add Friend</button>
      <button class="btn primary" (click)="openChatFromScan()">ğŸ’¬ Open Chat</button>
    </div>
  </div>
</div>

<!-- âœ… ADD CONTACT MODAL -->
<div class="modal" *ngIf="showAdd" (click)="closeAdd()">
  <div class="box" (click)="$event.stopPropagation()">
    <div class="mTitle">â• Add Contact</div>
    <div class="mSub">Save phone number / link Chatloop user automatically</div>

    <div class="addForm">
      <input
        class="input"
        placeholder="Name"
        [(ngModel)]="form.name"
      />

      <input
        class="input"
        placeholder="Phone number"
        [(ngModel)]="form.phone"
      />
    </div>

    <div class="actions2">
      <button class="btn ghost" (click)="closeAdd()">Cancel</button>
      <button class="btn primary" [disabled]="saving" (click)="saveManualContact()">
        {{ saving ? 'Saving...' : 'âœ… Save' }}
      </button>
    </div>
  </div>
</div>
