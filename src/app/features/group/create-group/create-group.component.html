<div class="page">
  <div class="shell">

    <!-- TOP BAR -->
    <div class="topbar">
      <div>
        <div class="title">Create {{ type === 'group' ? 'Group' : 'Channel' }}</div>
        <div class="sub">Telegram style creation â€¢ pick members â€¢ go chat</div>
      </div>

      <a routerLink="/app/chats" class="backBtn">â¬… Chats</a>
    </div>

    <!-- CARD -->
    <div class="card">

      <!-- TYPE SWITCH -->
      <div class="typeRow">
        <button class="typeBtn" [class.active]="type==='group'" (click)="selectType('group')">
          ğŸ‘¥ Group
        </button>

        <button class="typeBtn" [class.active]="type==='channel'" (click)="selectType('channel')">
          ğŸ“¢ Channel
        </button>
      </div>

      <!-- FORM -->
      <div class="form">
        <label>Name</label>
        <input [(ngModel)]="name" placeholder="Example: Anime Lovers" />

        <label>Description</label>
        <textarea [(ngModel)]="description" placeholder="About this group/channel..."></textarea>
      </div>

      <!-- SELECTED MEMBERS -->
      <div class="selectedBox">
        <div class="secTitle">Selected Members ({{ selected.size }})</div>

        <div class="chips" *ngIf="selected.size > 0; else noMembers">
          <div class="chip" *ngFor="let uid of selected">
            <span class="txt">{{ getUserLabel(uid) }}</span>
            <button class="x" (click)="remove(uid)">âœ–</button>
          </div>
        </div>

        <ng-template #noMembers>
          <div class="emptySmall">No members selected yet</div>
        </ng-template>
      </div>

      <!-- SEARCH USERS -->
      <div class="searchRow">
        <span class="ico">ğŸ”</span>
        <input [(ngModel)]="search" (input)="apply()" placeholder="Search users..." />
      </div>

      <!-- USERS LIST -->
      <div class="list">
        <div
          class="user"
          *ngFor="let u of filtered"
          [class.sel]="isSelected(u.uid)"
          (click)="toggleUser(u.uid)"
        >
          <div class="av">{{ getInitial(u) }}</div>

          <div class="meta">
            <div class="name">{{ u.name || u.email || 'User' }}</div>
            <div class="sub">{{ u.email || u.phone || '' }}</div>
          </div>

          <div class="check">
            {{ isSelected(u.uid) ? 'âœ…' : 'â•' }}
          </div>
        </div>

        <div class="empty" *ngIf="filtered.length === 0">
          No users found
        </div>
      </div>

      <p class="err" *ngIf="err">{{ err }}</p>
      <p class="ok" *ngIf="msg">{{ msg }}</p>

      <!-- CREATE BTN -->
      <button class="primary" (click)="create()" [disabled]="loading">
        {{ loading ? 'Creating...' : 'âœ… Create & Open Chat' }}
      </button>

    </div>
  </div>
</div>
