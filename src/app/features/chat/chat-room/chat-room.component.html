<div class="chatRoomWrap">

  <div class="topBar">
    <a routerLink="/chats" class="backBtn">â¬…</a>

    <div class="roomInfo">
      <div class="roomTitle">
        {{ room?.name || 'Chat' }}
        <span class="type"
              [class.dm]="room?.type==='dm'"
              [class.group]="room?.type==='group'"
              [class.channel]="room?.type==='channel'">
          {{ room?.type || 'dm' }}
        </span>
      </div>

      <div class="roomSub">
        <span *ngIf="room?.type === 'channel'">ğŸ“¢ Channel Â· Members: {{ room?.members?.length || 0 }}</span>
        <span *ngIf="room?.type === 'group'">ğŸ‘¥ Group Â· Members: {{ room?.members?.length || 0 }}</span>
        <span *ngIf="room?.type === 'dm'">ğŸ’¬ Direct Chat</span>
      </div>
    </div>
  </div>

  <div class="msgArea" *ngIf="!loading">
    <div
      class="msg"
      *ngFor="let m of messages"
      [class.me]="m.senderId === me"
      [class.deleted]="m.isDeleted"
    >
      <div class="bubble">
        <div class="text">{{ m.text }}</div>

        <div class="meta">
          <span *ngIf="m.editedAt">edited</span>
          <button *ngIf="m.senderId === me && !m.isDeleted"
                  class="delBtn"
                  (click)="deleteMessage(m)">
            delete
          </button>
        </div>
      </div>
    </div>

    <div id="msgEnd"></div>
  </div>

  <div class="loadingBox" *ngIf="loading">
    <div class="spinner"></div>
    <div class="loadingText">Loading messages...</div>
  </div>

  <div class="inputBar">
    <div class="channelLocked" *ngIf="room?.type === 'channel' && !canSend()">
      ğŸ”’ Only admins can send messages in this channel
    </div>

    <div class="inputRow">
      <input
        [(ngModel)]="text"
        placeholder="Write a message..."
        [disabled]="!canSend()"
        (keyup.enter)="send()"
      />

      <button class="sendBtn" (click)="send()" [disabled]="!canSend()">â¤</button>
    </div>
  </div>

</div>
