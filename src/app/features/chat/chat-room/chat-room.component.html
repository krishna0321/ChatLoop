<div class="chatRoomWrap">

  <!-- TOP BAR -->
  <div class="topBar">
    <a routerLink="/chats" class="backBtn">â¬…</a>

    <div class="roomInfo">
      <div class="roomTitle">
        {{ room?.name || 'Chat' }}

        <span class="type"
              [class.dm]="room?.type==='dm'"
              [class.group]="room?.type==='group'"
              [class.channel]="room?.type==='channel'">
          {{ room?.type || 'dm' }}
        </span>
      </div>

      <div class="roomSub">
        <span *ngIf="room?.type === 'channel'">
          ðŸ“¢ Channel Â· {{ room?.members?.length || 0 }} members
        </span>
        <span *ngIf="room?.type === 'group'">
          ðŸ‘¥ Group Â· {{ room?.members?.length || 0 }} members
        </span>
        <span *ngIf="room?.type === 'dm'">
          ðŸ’¬ Direct Chat
        </span>
      </div>
    </div>
  </div>

  <!-- MESSAGES -->
  <div class="msgArea" *ngIf="!loading">
    <div
      class="msg"
      *ngFor="let m of messages"
      [class.me]="m.senderId === me"
      [class.deleted]="m.isDeleted"
    >
      <div class="bubble">
        <div class="text">
          {{ m.isDeleted ? 'This message was deleted' : m.text }}
        </div>

        <div class="meta" *ngIf="!m.isDeleted">
          <span *ngIf="m.editedAt">edited</span>

          <button
            *ngIf="m.senderId === me"
            class="delBtn"
            (click)="deleteMessage(m)">
            delete
          </button>
        </div>
      </div>
    </div>

    <div id="msgEnd"></div>
  </div>

  <!-- LOADING -->
  <div class="loadingBox" *ngIf="loading">
    <div class="spinner"></div>
    <div class="loadingText">Loading messagesâ€¦</div>
  </div>

  <!-- INPUT -->
  <div class="inputBar">
    <div class="channelLocked" *ngIf="room?.type === 'channel' && !canSend()">
      ðŸ”’ Only admins can send messages in this channel
    </div>

    <div class="inputRow">
      <input
        [(ngModel)]="text"
        placeholder="Write a message..."
        [disabled]="!canSend()"
        (keyup.enter)="send()"
      />

      <button
        class="sendBtn"
        (click)="send()"
        [disabled]="!canSend() || !text.trim()">
        âž¤
      </button>
    </div>
  </div>

</div>
