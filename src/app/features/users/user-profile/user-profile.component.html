<div class="page" *ngIf="!loading && user as u; else loadingTpl">

  <!-- ðŸŒŒ BACKGROUND -->
  <div class="bg"></div>
  <div class="orb orb1"></div>
  <div class="orb orb2"></div>

  <!-- HEADER -->
  <header class="topbar">
    <button class="back" routerLink="/app/chats">â¬…</button>

    <div class="tinfo">
      <div class="t1">{{ u.name || 'User' }}</div>
      <div class="t2">{{ u.phone || u.email }}</div>
    </div>

    <button class="mini" (click)="copy(profileLink)" title="Copy share link">ðŸ”—</button>
  </header>

  <!-- CONTENT -->
  <div class="content">

    <!-- LEFT PROFILE -->
    <aside class="left fadeUp">

      <div class="avatarBox">
        <div class="avatar">
          {{ (u.name || 'U')[0] }}
        </div>

        <div class="status">
          <span class="dot"></span> Active
        </div>
      </div>

      <div class="name">{{ u.name || 'User' }}</div>
      <div class="sub">{{ u.bio || 'No bio available' }}</div>

      <div class="chips">
        <span class="chip mono">UID: {{ u.uid }}</span>
        <span class="chip danger" *ngIf="isBlocked">â›” Blocked</span>
      </div>

      <!-- buttons -->
      <div class="buttons" *ngIf="!isMe">
        <button class="btn primary" (click)="message()">ðŸ’¬ Message</button>

        <button class="btn ghost"
                (click)="addToContacts()"
                [disabled]="isContact">
          {{ isContact ? 'âœ… Added' : 'âž• Add Contact' }}
        </button>

        <button class="btn danger" (click)="toggleBlock()">
          {{ isBlocked ? 'âœ… Unblock' : 'â›” Block' }}
        </button>
      </div>

      <div class="buttons" *ngIf="isMe">
        <button class="btn primary" routerLink="/app/profile">
          ðŸ‘¤ Edit My Profile
        </button>
      </div>

    </aside>

    <!-- RIGHT INFO -->
    <main class="right">

      <!-- INFO CARD -->
      <section class="card fadeUp">
        <div class="cardHead">
          <h3>ðŸ“Œ Info</h3>
          <span class="tag">Profile</span>
        </div>

        <div class="row">
          <span>Phone</span>
          <b>{{ u.phone || '-' }}</b>
        </div>

        <div class="row">
          <span>Email</span>
          <b>{{ u.email || '-' }}</b>
        </div>

        <div class="row">
          <span>Share Link</span>
          <b class="mono">{{ profileLink }}</b>
        </div>

        <button class="copyBtn" (click)="copy(profileLink)">
          ðŸ“‹ Copy Link
        </button>
      </section>

      <!-- QR CARD -->
      <section class="card qrCard fadeUp">
        <div class="qrText">
          <h3>ðŸ“· QR Code</h3>
          <p>Scan to open this profile in Chatloop</p>

          <div class="mono small">{{ profileLink }}</div>

          <button class="copyBtn ghostBtn" (click)="copy(profileLink)">
            ðŸ”— Copy Link
          </button>
        </div>

        <div class="qrBox">
          <img class="qr" [src]="qrDataUrl" alt="QR Code" />
        </div>
      </section>

    </main>
  </div>
</div>

<!-- LOADING TEMPLATE -->
<ng-template #loadingTpl>
  <div class="loading">
    <div class="spinner"></div>
    Loading profile...
  </div>
</ng-template>
