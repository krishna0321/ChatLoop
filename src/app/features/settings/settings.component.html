<div class="settings-shell">

  <!-- ğŸŒŒ BACKGROUND -->
  <div class="bg"></div>
  <div class="orb orb1"></div>
  <div class="orb orb2"></div>

  <!-- âœ… Toast -->
  <div class="toast" *ngIf="toastVisible">{{ toastMsg }}</div>

  <!-- âœ… Mobile Tabs -->
  <div class="mobile-tabs">
    <button (click)="selectTab('profile')" [class.active]="activeTab==='profile'">ğŸ‘¤</button>
    <button (click)="selectTab('appearance')" [class.active]="activeTab==='appearance'">ğŸ¨</button>
    <button (click)="selectTab('notifications')" [class.active]="activeTab==='notifications'">ğŸ””</button>
    <button (click)="selectTab('privacy')" [class.active]="activeTab==='privacy'">ğŸ›¡ï¸</button>
    <button (click)="selectTab('account')" [class.active]="activeTab==='account'">ğŸ”</button>
  </div>

  <!-- âœ… LEFT MENU (Desktop only) -->
  <aside class="settings-nav fadeUp">
    <div class="nav-title">
      <div class="nav-icon">âš™ï¸</div>
      <div>
        <h2>Settings</h2>
        <p>Chatloop preferences</p>
      </div>
    </div>

    <button class="nav-item" [class.active]="activeTab==='profile'" (click)="selectTab('profile')">
      <span class="emoji">ğŸ‘¤</span> <span>Profile</span>
    </button>

    <button class="nav-item" [class.active]="activeTab==='appearance'" (click)="selectTab('appearance')">
      <span class="emoji">ğŸ¨</span> <span>Appearance</span>
    </button>

    <button class="nav-item" [class.active]="activeTab==='notifications'" (click)="selectTab('notifications')">
      <span class="emoji">ğŸ””</span> <span>Notifications</span>
    </button>

    <button class="nav-item" [class.active]="activeTab==='privacy'" (click)="selectTab('privacy')">
      <span class="emoji">ğŸ›¡ï¸</span> <span>Privacy</span>
    </button>

    <button class="nav-item" [class.active]="activeTab==='account'" (click)="selectTab('account')">
      <span class="emoji">ğŸ”</span> <span>Account</span>
    </button>
  </aside>

  <!-- âœ… MAIN -->
  <main class="settings-main fadeUp">
    <div class="settings-header">
      <div>
        <h1>âš™ï¸ Settings</h1>
        <p>Manage your Chatloop preferences</p>
      </div>

      <button class="save-btn" (click)="save()" [disabled]="saving || loading || !hasChanges">
        {{ saving ? 'Saving...' : (hasChanges ? 'Save âœ…' : 'Saved âœ…') }}
      </button>
    </div>

    <div *ngIf="loading" class="loading">Loading settings...</div>

    <div *ngIf="!loading" class="page">

      <!-- âœ… PROFILE -->
      <section class="card" *ngIf="activeTab==='profile'">
        <h3>ğŸ‘¤ Profile</h3>

        <div class="avatar-row">
          <div class="avatar">{{ (settings.name || 'U').slice(0,1) }}</div>
          <div>
            <div class="big">{{ settings.name || 'User' }}</div>
            <div class="small">Chatloop Account</div>
          </div>
        </div>

        <div class="field">
          <label>Name</label>
          <input [(ngModel)]="settings.name" (ngModelChange)="trackChanges()" placeholder="Enter your name" />
        </div>

        <div class="field">
          <label>Bio</label>
          <textarea [(ngModel)]="settings.bio" (ngModelChange)="trackChanges()" placeholder="Write something about you..."></textarea>
        </div>

        <div class="field">
          <label>Phone</label>
          <input [(ngModel)]="settings.phone" (ngModelChange)="trackChanges()" placeholder="Optional phone number" />
        </div>
      </section>

      <!-- âœ… APPEARANCE -->
      <section class="card" *ngIf="activeTab==='appearance'">
        <h3>ğŸ¨ Appearance</h3>

        <div class="toggle-row">
          <div>
            <div class="toggle-title">Dark Mode</div>
            <div class="toggle-sub">Reduce eye strain</div>
          </div>

          <label class="switch">
            <input type="checkbox"
                   [(ngModel)]="settings.darkMode"
                   (ngModelChange)="applyTheme(); trackChanges()" />
            <span class="slider"></span>
          </label>
        </div>

        <div class="preview-row">
          <div class="preview dark">
            <div class="pTitle">Dark</div>
          </div>
          <div class="preview light">
            <div class="pTitle">Light</div>
          </div>
        </div>
      </section>

      <!-- âœ… NOTIFICATIONS -->
      <section class="card" *ngIf="activeTab==='notifications'">
        <h3>ğŸ”” Notifications</h3>

        <div class="toggle-row">
          <div>
            <div class="toggle-title">Message Notifications</div>
            <div class="toggle-sub">Show push alerts</div>
          </div>

          <label class="switch">
            <input type="checkbox"
                   [(ngModel)]="settings.notifyMessages"
                   (ngModelChange)="trackChanges()" />
            <span class="slider"></span>
          </label>
        </div>

        <div class="toggle-row">
          <div>
            <div class="toggle-title">Sound</div>
            <div class="toggle-sub">Play sound on new message</div>
          </div>

          <label class="switch">
            <input type="checkbox"
                   [(ngModel)]="settings.notifySound"
                   (ngModelChange)="trackChanges()" />
            <span class="slider"></span>
          </label>
        </div>
      </section>

      <!-- âœ… PRIVACY -->
      <section class="card" *ngIf="activeTab==='privacy'">
        <h3>ğŸ›¡ï¸ Privacy</h3>

        <div class="toggle-row">
          <div>
            <div class="toggle-title">Show Online Status</div>
            <div class="toggle-sub">Let others see when you're online</div>
          </div>

          <label class="switch">
            <input type="checkbox"
                   [(ngModel)]="settings.showOnlineStatus"
                   (ngModelChange)="trackChanges()" />
            <span class="slider"></span>
          </label>
        </div>

        <div class="toggle-row">
          <div>
            <div class="toggle-title">Allow Friend Requests</div>
            <div class="toggle-sub">Allow new connections</div>
          </div>

          <label class="switch">
            <input type="checkbox"
                   [(ngModel)]="settings.allowFriendRequests"
                   (ngModelChange)="trackChanges()" />
            <span class="slider"></span>
          </label>
        </div>
      </section>

      <!-- âœ… ACCOUNT -->
      <section class="card danger" *ngIf="activeTab==='account'">
        <h3>ğŸ” Account</h3>

        <div class="action-row">
          <button class="secondary" (click)="logout()">ğŸšª Logout</button>
          <button class="danger-btn" (click)="deleteAccount()">ğŸ—‘ Delete</button>
        </div>

        <p class="note">âš  Delete account is permanent.</p>
      </section>

    </div>
  </main>
</div>
