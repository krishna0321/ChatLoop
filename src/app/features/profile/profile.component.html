<div class="page" *ngIf="user as u">

  <!-- üåå Background -->
  <div class="bg"></div>
  <div class="orb orb1"></div>
  <div class="orb orb2"></div>

  <!-- ‚úÖ Header -->
  <header class="topbar fadeIn">
    <div class="tLeft">
      <div class="hTitle">üë§ Profile</div>
      <div class="hSub">Your Chatloop identity ‚Ä¢ QR sharing ‚Ä¢ Telegram style</div>
    </div>

    <button class="btn primary" (click)="toggleEdit()">
      {{ editMode ? '‚úñ Close' : '‚úè Edit Profile' }}
    </button>
  </header>

  <!-- ‚úÖ Toast -->
  <div class="toast ok" *ngIf="msg">{{ msg }}</div>
  <div class="toast err" *ngIf="err">{{ err }}</div>

  <!-- ‚úÖ HERO -->
  <section class="hero fadeUp">

    <div class="heroLeft">
      <!-- Avatar -->
      <div class="avatarArea">
        <div class="avatarImg" [class.loading]="uploading">
          <img *ngIf="u.photoURL" [src]="u.photoURL" class="img" alt="avatar" />
          <div *ngIf="!u.photoURL" class="txt">{{ (u.name || 'U')[0] }}</div>
        </div>

        <label class="camBtn" title="Upload photo">
          üì∑
          <input
            type="file"
            hidden
            accept="image/*"
            (change)="onPickAvatar($event)"
          />
        </label>

        <div class="avatarHint">
          {{ uploading ? 'Uploading photo...' : 'Upload profile photo (Max 2MB)' }}
        </div>

        <div class="avatarErr" *ngIf="avatarErr">{{ avatarErr }}</div>
      </div>

      <!-- Name / badges -->
      <div class="heroMeta">
        <div class="pName">{{ u.name || 'User' }}</div>
        <div class="pEmail">{{ u.email }}</div>

        <div class="badges">
          <span class="pill online">
            <span class="dot"></span> Active
          </span>

          <span class="pill mono" title="User ID">
            {{ (u.uid || '').slice(0, 10) }}...
          </span>
        </div>

        <div class="heroBtns">
          <button class="btn ghost" (click)="copyText(u.uid)">üìã Copy UID</button>
          <button class="btn ghost" (click)="copyText(profileLink)">üîó Copy Share Link</button>
        </div>
      </div>
    </div>

    <!-- QR -->
    <div class="heroRight">
      <div class="qrBox">
        <div class="qrTop">
          <div class="qrTitle">üì∑ My QR</div>
          <div class="qrSub">Scan to open my profile</div>
        </div>

        <img class="qr" [src]="qrDataUrl" alt="QR Code" />

        <div class="qrLink">
          <span class="mono">{{ profileLink }}</span>
          <button class="mini" (click)="copyText(profileLink)">Copy</button>
        </div>
      </div>
    </div>
  </section>

  <!-- ‚úÖ GRID -->
  <section class="grid fadeUp">

    <!-- Details -->
    <div class="card">
      <div class="cardTitle">üìå Account Info</div>

      <div class="row">
        <span>Email</span>
        <b>{{ u.email }}</b>
      </div>

      <div class="row">
        <span>Phone</span>
        <b>{{ u.phone || '-' }}</b>
      </div>

      <div class="row">
        <span>User ID</span>
        <b class="mono">{{ u.uid }}</b>
      </div>
    </div>

    <!-- Edit -->
    <div class="card" *ngIf="editMode">
      <div class="cardTitle">‚úèÔ∏è Edit Profile</div>

      <div class="form">
        <div class="field">
          <label>Name</label>
          <input [(ngModel)]="form.name" placeholder="Enter name" />
        </div>

        <div class="field">
          <label>Phone</label>
          <input [(ngModel)]="form.phone" placeholder="Enter phone" />
        </div>

        <div class="actions">
          <button class="btn primary" (click)="save()">‚úÖ Save</button>
          <button class="btn ghost" (click)="reset(u)">‚Ü© Reset</button>
        </div>
      </div>
    </div>

    <!-- Quick Actions -->
    <div class="card">
      <div class="cardTitle">‚ö° Quick Actions</div>

      <button class="actionRow" (click)="copyText(u.uid)">
        <span class="ic">üìã</span>
        <span class="tx">Copy UID</span>
        <span class="go">‚Ä∫</span>
      </button>

      <button class="actionRow" (click)="copyText(profileLink)">
        <span class="ic">üîó</span>
        <span class="tx">Copy Share Link</span>
        <span class="go">‚Ä∫</span>
      </button>

      <button class="actionRow" (click)="toggleEdit()">
        <span class="ic">‚úèÔ∏è</span>
        <span class="tx">{{ editMode ? 'Close Edit Mode' : 'Edit Profile' }}</span>
        <span class="go">‚Ä∫</span>
      </button>
    </div>

  </section>

</div>
